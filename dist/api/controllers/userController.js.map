{"version":3,"sources":["../../../api/controllers/userController.js"],"names":["exports","signUp","req","res","body","name","email","password","sql","text","values","user","query","err","result","status","json","error","rows","length","message","bcrypt","hash","rowCount","token","jwt","sign","process","env","JWT_KEY","expiresIn","auth","end","login","compare","match"],"mappings":"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","file":"userController.js","sourcesContent":["import bcrypt from 'bcrypt';\r\n\r\nimport jwt from 'jsonwebtoken';\r\n\r\nimport user from '../models/userModel';\r\n\r\n\r\nexports.signUp = (req, res) => {\r\n  const { name, email, password } = req.body;\r\n\r\n  const sql = {\r\n    text: 'SELECT * FROM users WHERE email= $1',\r\n    values: [email],\r\n  };\r\n  user.query(sql, (err, result) => {\r\n    if (err) {\r\n      return res.status(500)\r\n        .json({\r\n          error: err,\r\n        });\r\n    }\r\n    if (result.rows.length > 0) {\r\n      return res.status(409)\r\n        .json({\r\n          message: 'Email already exists',\r\n        });\r\n    }\r\n    bcrypt.hash(password, 10, (err, hash) => {\r\n      if (err) {\r\n        return res.status(500)\r\n          .json({\r\n            error: err,\r\n          });\r\n      }\r\n      // const password = hash;\r\n      const query = {\r\n        text: 'INSERT INTO users(email, name, password, admin) VALUES($1, $2, $3, $4 )',\r\n        values: [email, name, hash, false],\r\n      };\r\n      user.query(query, (err, result) => {\r\n        if (err) {\r\n          return res.status(500)\r\n            .json({\r\n              message: `Not Found ${err}`,\r\n            });\r\n        }\r\n        if (result.rowCount === 1) {\r\n          // Create token\r\n          const token = jwt.sign({\r\n            email: email,\r\n            name: name,\r\n          }, process.env.JWT_KEY, {\r\n            expiresIn: 86400,\r\n          });\r\n          res.status(201)\r\n            .json({\r\n              auth: true,\r\n              token: token,\r\n            })\r\n            .end();\r\n        }\r\n      });\r\n    });\r\n  });\r\n};\r\n\r\nexports.login = (req, res) => {\r\n  const email = req.body.email;\r\n  const password = req.body.password;\r\n\r\n  let sql = {\r\n    text: 'SELECT * FROM users WHERE email= $1',\r\n    values: [email],\r\n  };\r\n  user.query(sql, (err, result) => {\r\n    if (err) {\r\n      res.status(500)\r\n        .json({\r\n          error: err,\r\n        })\r\n        .end();\r\n    }\r\n    // res.json(result.rows.length);\r\n    if (result && result.rows.length === 1) {\r\n      bcrypt.compare(password, result.rows[0].password, (err, match) => {\r\n        if (match) {\r\n          // Create token\r\n          let token = jwt.sign({\r\n            email: result.rows[0].email,\r\n            name: result.rows[0].name,\r\n          }, process.env.JWT_KEY, {\r\n            expiresIn: 86400,\r\n          });\r\n          res.status(200)\r\n            .json({\r\n              auth: true,\r\n              token: token,\r\n            })\r\n            .end();\r\n        }\r\n      });\r\n    } else {\r\n      res.status(401)\r\n        .json({\r\n          error: 'Login Authentication Failed',\r\n        })\r\n        .end();\r\n    }\r\n  });\r\n};\r\n"]}