{"version":3,"sources":["../../../api/controllers/requestsController.js"],"names":["_userModel","require","_userModel2","_interopRequireDefault","obj","__esModule","default","exports","getAllUserRequests","req","res","userId","userInfo","id","sql","text","values","query","err","result","status","set","json","user","rows","getSingleRequest","parseInt","params","requestId","length","message","createRequest","body","name","email","request","dept","modifyRequest","rowCount","error","end","deleteRequest","getAllRequests","approveRequest","disapproveRequest","resolveRequest"],"mappings":"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","file":"requestsController.js","sourcesContent":["'use strict';\r\n\r\nvar _userModel = require('../models/userModel');\r\n\r\nvar _userModel2 = _interopRequireDefault(_userModel);\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\nexports.getAllUserRequests = function (req, res) {\r\n  var userId = req.userInfo.id;\r\n  var sql = {\r\n    text: 'SELECT * FROM requests WHERE user_id=$1',\r\n    values: [userId]\r\n  };\r\n  _userModel2.default.query(sql, function (err, result) {\r\n    res.status(200).set('Access-Control-Allow-Origin', '*').set('Access-Control-Allow-Credentials', 'true').set('Access-Control-Allow-Methods', 'POST, GET, OPTIONS, DELETE').set('Access-Control-Max-Age', '3600').set('Access-Control-Allow-Headers', 'Content-Type, Accept, X-Requested-With, remember-me').json({\r\n      user: req.userInfo,\r\n      result: result.rows\r\n    });\r\n  });\r\n};\r\n\r\nexports.getSingleRequest = function (req, res) {\r\n  var userId = req.userInfo.id;\r\n  var id = parseInt(req.params.requestId, 10);\r\n  var sql = {\r\n    text: 'SELECT * FROM requests WHERE id=$1 AND user_id=$2',\r\n    values: [id, userId]\r\n  };\r\n  _userModel2.default.query(sql, function (err, result) {\r\n    // if (err) {\r\n    //   return res.status(500)\r\n    //     .json({\r\n    //       error: err,\r\n    //     })\r\n    //     .end();\r\n    // }\r\n    if (result.rows.length > 0) {\r\n      return res.status(200).json({\r\n        result: result.rows\r\n      });\r\n    }\r\n    res.status(404).json({\r\n      message: 'Request not found'\r\n    });\r\n  });\r\n};\r\n\r\nexports.createRequest = function (req, res) {\r\n  var userId = req.userInfo.id;\r\n  var query = {\r\n    text: 'INSERT INTO requests(user_id, requester_name, requester_email, date, status, request, dept) VALUES($1, $2, $3, NOW() ,$4, $5, $6)',\r\n    values: [userId, req.body.name, req.body.email, 'pending', req.body.request, req.body.dept]\r\n  };\r\n  _userModel2.default.query(query, function (err, result) {\r\n    // if (err) {\r\n    //   return res.status(500)\r\n    //     .json({\r\n    //       err,\r\n    //     });\r\n    // }\r\n    res.status(201).json({\r\n      message: 'Request Created successfully'\r\n    });\r\n    if (req.body.name && req.body.email === null) {\r\n      res.status(400).json({\r\n        message: 'Bad Request'\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\nexports.modifyRequest = function (req, res) {\r\n  var userId = req.userInfo.id;\r\n  var id = parseInt(req.params.requestId, 10);\r\n  var query = {\r\n    text: 'UPDATE requests SET requester_name=$1, requester_email=$2, date=NOW(), request=$3, dept=$4 WHERE id=$5',\r\n    values: [req.body.name, req.body.email, req.body.request, req.body.dept, id]\r\n  };\r\n\r\n  _userModel2.default.query(query, function (err, result) {\r\n    if (err) {\r\n      return res.status(500).json({\r\n        err: err\r\n      });\r\n    }\r\n    if (result.rowCount === 1) {\r\n      var sql = {\r\n        text: 'SELECT * FROM requests WHERE id=$1 AND user_id=$2',\r\n        values: [id, userId]\r\n      };\r\n      _userModel2.default.query(sql, function (err, result) {\r\n        if (err) {\r\n          return res.status(500).json({\r\n            error: err\r\n          }).end();\r\n        }\r\n        if (result.rows.length > 0) {\r\n          return res.status(200).json({\r\n            result: result.rows\r\n          });\r\n        }\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\nexports.deleteRequest = function (req, res) {\r\n  var id = parseInt(req.params.requestId, 10);\r\n  var query = {\r\n    text: 'DELETE FROM requests WHERE id=$1',\r\n    values: [id]\r\n  };\r\n  _userModel2.default.query(query, function (err, result) {\r\n    // if (err) {\r\n    //   return res.status(500)\r\n    //     .json({\r\n    //       err,\r\n    //     });\r\n    // }\r\n    if (result.rowCount === 0) {\r\n      return res.status(404).json({\r\n        message: 'Request Not found'\r\n      });\r\n    }\r\n    res.status(200).json({\r\n      message: 'Request deleted successfully'\r\n    });\r\n  });\r\n};\r\n\r\n// Admin Controllers\r\nexports.getAllRequests = function (req, res) {\r\n  // const userId = req.userInfo.id;\r\n  var sql = {\r\n    text: 'SELECT * FROM requests'\r\n  };\r\n  _userModel2.default.query(sql, function (err, result) {\r\n    // if (err) {\r\n    //   return res.status(500)\r\n    //     .json({\r\n    //       err,\r\n    //     })\r\n    //     .end();\r\n    // }\r\n    // res.set('Access-Control-Allow-Origin', '*');\r\n    res.status(200).set('Access-Control-Allow-Origin', '*').json({\r\n      user: req.userInfo,\r\n      result: result.rows\r\n    });\r\n  });\r\n};\r\n\r\nexports.approveRequest = function (req, res) {\r\n  var userId = req.userInfo.id;\r\n  var id = parseInt(req.params.requestId, 10);\r\n  var query = {\r\n    text: 'UPDATE requests SET status=$1 WHERE id=$2',\r\n    values: ['approved', id]\r\n  };\r\n\r\n  _userModel2.default.query(query, function (err, result) {\r\n    // if (err) {\r\n    //   return res.status(500)\r\n    //     .json({\r\n    //       err,\r\n    //     });\r\n    // }\r\n    if (result.rowCount === 1) {\r\n      var sql = {\r\n        text: 'SELECT * FROM requests WHERE id=$1',\r\n        values: [id]\r\n      };\r\n      _userModel2.default.query(sql, function (err, result) {\r\n        if (err) {\r\n          return res.status(500).json({\r\n            error: err\r\n          }).end();\r\n        }\r\n        if (result.rows.length > 0) {\r\n          return res.status(200).json({\r\n            result: result.rows\r\n          });\r\n        }\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\nexports.disapproveRequest = function (req, res) {\r\n  var userId = req.userInfo.id;\r\n  var id = parseInt(req.params.requestId, 10);\r\n  var query = {\r\n    text: 'UPDATE requests SET status=$1 WHERE id=$2',\r\n    values: ['disapproved', id]\r\n  };\r\n\r\n  _userModel2.default.query(query, function (err, result) {\r\n    // if (err) {\r\n    //   return res.status(500)\r\n    //     .json({\r\n    //       err,\r\n    //     });\r\n    // }\r\n    if (result.rowCount === 1) {\r\n      var sql = {\r\n        text: 'SELECT * FROM requests WHERE id=$1',\r\n        values: [id]\r\n      };\r\n      _userModel2.default.query(sql, function (err, result) {\r\n        if (err) {\r\n          return res.status(500).json({\r\n            error: err\r\n          }).end();\r\n        }\r\n        if (result.rows.length > 0) {\r\n          return res.status(200).json({\r\n            result: result.rows\r\n          });\r\n        }\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\nexports.resolveRequest = function (req, res) {\r\n  var userId = req.userInfo.id;\r\n  var id = parseInt(req.params.requestId, 10);\r\n  var query = {\r\n    text: 'UPDATE requests SET status=$1 WHERE id=$2',\r\n    values: ['resolved', id]\r\n  };\r\n\r\n  _userModel2.default.query(query, function (err, result) {\r\n    // if (err) {\r\n    //   return res.status(500)\r\n    //     .json({\r\n    //       err,\r\n    //     });\r\n    // }\r\n    if (result.rowCount === 1) {\r\n      var sql = {\r\n        text: 'SELECT * FROM requests WHERE id=$1',\r\n        values: [id]\r\n      };\r\n      _userModel2.default.query(sql, function (err, result) {\r\n        if (err) {\r\n          return res.status(500).json({\r\n            error: err\r\n          }).end();\r\n        }\r\n        if (result.rows.length > 0) {\r\n          return res.status(200).json({\r\n            result: result.rows\r\n          });\r\n        }\r\n      });\r\n    }\r\n  });\r\n};\r\n//# sourceMappingURL=requestsController.js.map"]}