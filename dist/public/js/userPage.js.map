{"version":3,"sources":["../../../public/js/userPage.js"],"names":["requests","document","getElementById","alertBox","token","JSON","parse","sessionStorage","getItem","url","URL","window","location","href","successMessage","searchParams","get","successType","messageBox","errorBox","innerHTML","style","display","setTimeout","myHeader","Headers","Authorization","apiUrl","auth","fetch","headers","then","res","json","data","output","result","length","count","forEach","request","requester_name","requester_email","status","date","id","catch","error","deleteData","requestId","confirm","method","resp","message","undefined"],"mappings":";;AAAA,IAAMA,WAAWC,SAASC,cAAT,CAAwB,cAAxB,CAAjB;AACA,IAAMC,WAAWF,SAASC,cAAT,CAAwB,WAAxB,CAAjB;AACA,IAAME,QAAQC,KAAKC,KAAL,CAAWC,eAAeC,OAAf,CAAuB,OAAvB,CAAX,CAAd;;AAEA,IAAMC,MAAM,IAAIC,GAAJ,CAAQC,OAAOC,QAAP,CAAgBC,IAAxB,CAAZ;AACA,IAAMC,iBAAiBL,IAAIM,YAAJ,CAAiBC,GAAjB,CAAqB,SAArB,CAAvB;AACA,IAAMC,cAAcR,IAAIM,YAAJ,CAAiBC,GAAjB,CAAqB,MAArB,CAApB;AACA,IAAME,aAAajB,SAASC,cAAT,CAAwB,eAAxB,CAAnB;AACA,IAAMiB,WAAWlB,SAASC,cAAT,CAAwB,eAAxB,CAAjB;;AAEA,IAAIY,mBAAmB,MAAvB,EAA+B;AAC7B,UAAQG,WAAR;AACE,SAAK,GAAL;AACEC,iBAAWE,SAAX,GAAuB,6BAAvB;AACAF,iBAAWG,KAAX,CAAiBC,OAAjB,GAA2B,OAA3B;AACA;AACF,SAAK,GAAL;AACEJ,iBAAWE,SAAX,GAAuB,2CAAvB;AACAF,iBAAWG,KAAX,CAAiBC,OAAjB,GAA2B,OAA3B;AACA;AACF,SAAK,GAAL;AACEJ,iBAAWE,SAAX,GAAuB,sCAAvB;AACAF,iBAAWG,KAAX,CAAiBC,OAAjB,GAA2B,OAA3B;AAXJ;AAaAC,aAAW,YAAM;AACfL,eAAWG,KAAX,CAAiBC,OAAjB,GAA2B,MAA3B;AACD,GAFD,EAEG,IAFH;AAGD;;AAED,IAAIR,mBAAmB,OAAvB,EAAgC;AAC9B,UAAQG,WAAR;AACE,SAAK,GAAL;AACEE,eAASC,SAAT,GAAqB,kCAArB;AACAD,eAASE,KAAT,CAAeC,OAAf,GAAyB,OAAzB;AACA;AACF,SAAK,GAAL;AACEH,eAASC,SAAT,GAAqB,+CAArB;AACAD,eAASE,KAAT,CAAeC,OAAf,GAAyB,OAAzB;AACA;AACF,SAAK,GAAL;AACEH,eAASC,SAAT,GAAqB,wCAArB;AACAD,eAASE,KAAT,CAAeC,OAAf,GAAyB,OAAzB;AAXJ;AAaAC,aAAW,YAAM;AACfJ,aAASE,KAAT,CAAeC,OAAf,GAAyB,MAAzB;AACD,GAFD,EAEG,IAFH;AAGD;;AAED,IAAME,WAAW,IAAIC,OAAJ,CAAY;AAC3BC,6BAAyBtB,MAAMA;AADJ,CAAZ,CAAjB;;AAIA,IAAMuB,SAAS,yBAAf;;AAEA,IAAIvB,SAASA,MAAMwB,IAAnB,EAAyB;AACvBC,QAAMF,MAAN,EAAc;AACZG,aAASN;AADG,GAAd,EAGGO,IAHH,CAGQ;AAAA,WAAOC,IAAIC,IAAJ,EAAP;AAAA,GAHR,EAIGF,IAJH,CAIQ,UAACG,IAAD,EAAU;AACd,QAAIC,SAAS,EAAb;AACA,QAAID,KAAKE,MAAL,CAAYC,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B,UAAIC,QAAQ,CAAZ;AACAJ,WAAKE,MAAL,CAAYG,OAAZ,CAAoB,UAACC,OAAD,EAAa;AAC/BL,wEAEgBG,SAAS,CAFzB,wCAGgBE,QAAQC,cAHxB,uCAIgBD,QAAQE,eAJxB,gEAKyCF,QAAQG,MALjD,qBAKuEH,QAAQG,MAL/E,8CAMgBH,QAAQI,IANxB,oGAQmDJ,QAAQK,EAR3D,qGAS8CL,QAAQK,EATtD,oHAUgEL,QAAQK,EAVxE;AAcD,OAfD;AAgBA7C,eAASoB,SAAT,GAAqBe,MAArB;AACD,KAnBD,MAmBO;AACLA;AAIAnC,eAASoB,SAAT,GAAqBe,MAArB;AACD;AACF,GAhCH,EAiCGW,KAjCH,CAiCS,UAACC,KAAD,EAAW;AAChB5C,aAASiB,SAAT;AAoBAnB,aAASC,cAAT,CAAwB,eAAxB,EAAyCmB,KAAzC,CAA+CC,OAA/C,GAAyD,OAAzD;AACD,GAvDH;AAwDD,CAzDD,MAyDO;AACLnB,WAASiB,SAAT;AAoBAnB,WAASC,cAAT,CAAwB,eAAxB,EAAyCmB,KAAzC,CAA+CC,OAA/C,GAAyD,OAAzD;AACD;;AAED,SAAS0B,UAAT,CAAoBC,SAApB,EAA+B;AAC7B,MAAIC,QAAQ,eAAR,CAAJ,EAA8B;AAC5BrB,qCAA+BoB,SAA/B,cAAmD;AACjDE,cAAQ,QADyC;AAEjDrB,eAASN;AAFwC,KAAnD,EAIGO,IAJH,CAIQ;AAAA,aAAQqB,KAAKnB,IAAL,EAAR;AAAA,KAJR,EAKGF,IALH,CAKQ,UAACG,IAAD,EAAU;AACd,UAAIA,KAAKmB,OAAL,KAAiB,EAAjB,IAAuBnB,KAAKa,KAAL,KAAeO,SAA1C,EAAqD;AACnD3C,eAAOC,QAAP,CAAgBC,IAAhB,GAAuB,+BAAvB;AACD,OAFD,MAEO,IAAIqB,KAAKa,KAAL,KAAe,EAAf,IAAqBb,KAAKmB,OAAL,KAAiBC,SAA1C,EAAqD;AAC1D3C,eAAOC,QAAP,CAAgBC,IAAhB,GAAuB,gCAAvB;AACD;AACF,KAXH;AAYD;AACF","file":"userPage.js","sourcesContent":["const requests = document.getElementById('userRequests');\r\nconst alertBox = document.getElementById('alert-box');\r\nconst token = JSON.parse(sessionStorage.getItem('token'));\r\n\r\nconst url = new URL(window.location.href);\r\nconst successMessage = url.searchParams.get('success');\r\nconst successType = url.searchParams.get('type');\r\nconst messageBox = document.getElementById('alert-success');\r\nconst errorBox = document.getElementById('alert-warning');\r\n\r\nif (successMessage === 'true') {\r\n  switch (successType) {\r\n    case '1':\r\n      messageBox.innerHTML = '<p>Successfully updated</p>';\r\n      messageBox.style.display = 'block';\r\n      break;\r\n    case '2':\r\n      messageBox.innerHTML = '<p>Successfully created a new request</p>';\r\n      messageBox.style.display = 'block';\r\n      break;\r\n    case '3':\r\n      messageBox.innerHTML = '<p>Request delete was successful</p>';\r\n      messageBox.style.display = 'block';\r\n  }\r\n  setTimeout(() => {\r\n    messageBox.style.display = 'none';\r\n  }, 3000);\r\n}\r\n\r\nif (successMessage === 'false') {\r\n  switch (successType) {\r\n    case '1':\r\n      errorBox.innerHTML = '<p>Update was not successful</p>';\r\n      errorBox.style.display = 'block';\r\n      break;\r\n    case '2':\r\n      errorBox.innerHTML = '<p>Creation of new request not successful</p>';\r\n      errorBox.style.display = 'block';\r\n      break;\r\n    case '3':\r\n      errorBox.innerHTML = '<p>Sorry Request cannot be deleted</p>';\r\n      errorBox.style.display = 'block';\r\n  }\r\n  setTimeout(() => {\r\n    errorBox.style.display = 'none';\r\n  }, 3000);\r\n}\r\n\r\nconst myHeader = new Headers({\r\n  Authorization: `Bearer ${token.token}`,\r\n});\r\n\r\nconst apiUrl = '/api/v1/users/requests/';\r\n\r\nif (token && token.auth) {\r\n  fetch(apiUrl, {\r\n    headers: myHeader,\r\n  })\r\n    .then(res => res.json())\r\n    .then((data) => {\r\n      let output = '';\r\n      if (data.result.length > 0) {\r\n        let count = 0;\r\n        data.result.forEach((request) => {\r\n          output += `\r\n                <tr>\r\n                    <td>${count += 1}</td>\r\n                    <td>${request.requester_name}</td>\r\n                    <td>${request.requester_email}</td>\r\n                    <td><span class=\"label label-${request.status} tableClear\">${request.status}</span></td>\r\n                    <td>${request.date}</td>\r\n                    <td>\r\n                        <a href=\"user-view-details.html?id=${request.id}\" class=\"btn-sm btn-primary\">View</a>\r\n                        <a href=\"edit-request.html?id=${request.id}\" class=\"btn-sm btn-edit\">Edit</a>\r\n                        <a href=\"javascript:void(0)\" onClick=deleteData(${request.id}); class=\"btn-sm btn-delete\">Delete</a>\r\n                    </td>\r\n                </tr>\r\n        `;\r\n        });\r\n        requests.innerHTML = output;\r\n      } else {\r\n        output = `\r\n        <div class=\"alert\" style=\"display: block\">\r\n            <p>No requests yet</p>\r\n        </div>`;\r\n        requests.innerHTML = output;\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      alertBox.innerHTML = `\r\n    <header>\r\n        <a class=\"brand\" href=\"#\">M-Tracker</a>\r\n        <nav class=\"nav-bar\">\r\n            <ul>\r\n                <li><a class=\"btn btn-default\" href=\"../sign-in.html\">Log in</a></li>\r\n            </ul>\r\n        </nav>\r\n    </header>\r\n    <div class=\"wrapper\" style=\"margin-top: 200px\">\r\n        <div class=\"alert\" id=\"alert-message\">\r\n            <p>\r\n                Oops! Sorry, Your session has ended, therefore You are not Authorized to view this page, <strong>kindly log in!</strong>\r\n            </p>\r\n        </div>\r\n    </div>\r\n    <footer>\r\n        <p>&copy;2018 VeeqTor</p>\r\n    </footer>\r\n      `;\r\n      document.getElementById('alert-message').style.display = 'block';\r\n    });\r\n} else {\r\n  alertBox.innerHTML = `\r\n    <header>\r\n        <a class=\"brand\" href=\"#\">M-Tracker</a>\r\n        <nav class=\"nav-bar\">\r\n            <ul>\r\n                <li><a class=\"btn btn-default\" href=\"../sign-in.html\">Log in</a></li>\r\n            </ul>\r\n        </nav>\r\n    </header>\r\n    <div class=\"wrapper\" style=\"margin-top: 200px\">\r\n        <div class=\"alert\" id=\"alert-message\">\r\n            <p>\r\n                Oops! Sorry, You do not have access to this page!!\r\n            </p>\r\n        </div>\r\n    </div>\r\n    <footer>\r\n        <p>&copy;2018 VeeqTor</p>\r\n    </footer>\r\n      `;\r\n  document.getElementById('alert-message').style.display = 'block';\r\n}\r\n\r\nfunction deleteData(requestId) {\r\n  if (confirm('Are you sure?')) {\r\n    fetch(`api/v1/users/requests/${requestId}/delete`, {\r\n      method: 'DELETE',\r\n      headers: myHeader,\r\n    })\r\n      .then(resp => resp.json())\r\n      .then((data) => {\r\n        if (data.message !== '' && data.error === undefined) {\r\n          window.location.href = 'user.html?success=true&type=3';\r\n        } else if (data.error !== '' && data.message === undefined) {\r\n          window.location.href = 'user.html?success=false&type=3';\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\n"]}